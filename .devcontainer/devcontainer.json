{
  // Claym 開発コンテナ構成（VS Code 用）
  "name": "Claym AI Dev Environment",

  // コンテナビルド
  "dockerFile": "Dockerfile",

  // ポート転送
  "forwardPorts": [24282, 9323],
  "portsAttributes": {
    "24282": { "label": "Serena MCP dashboard", "onAutoForward": "silent" },
    "9323": { "label": "Playwright MCP UI", "onAutoForward": "openBrowser" }
  },

  // 追加権限（Playwright 等用）
  "runArgs": [
    "--cap-add=SYS_ADMIN",
    "--security-opt=seccomp=unconfined",
    "--shm-size=1g"
  ],

  // 認証トークン（あれば利用、無ければそのまま起動）
  "remoteEnv": {
    "ANTHROPIC_API_KEY": "${localEnv:ANTHROPIC_API_KEY}",
    "OPENAI_API_KEY": "${localEnv:OPENAI_API_KEY}",
    "GEMINI_API_KEY": "${localEnv:GEMINI_API_KEY}",
    "GITHUB_TOKEN": "${localEnv:GITHUB_TOKEN}",
    "FIRECRAWL_API_KEY": "${localEnv:FIRECRAWL_API_KEY}"
  },

  // VS Code の拡張と設定（重複を整理済み）
  "customizations": {
    "vscode": {
      "extensions": [
        // AI アシスト
        "anthropic.claude-code",
        "openai.chatgpt",
        // Git / GitHub
        "eamodio.gitlens",
        "github.vscode-pull-request-github",
        // Markdown
        "yzhang.markdown-all-in-one",
        "shd101wyy.markdown-preview-enhanced",
        // 品質・整形
        "streetsidesoftware.code-spell-checker",
        "dbaeumer.vscode-eslint",
        "esbenp.prettier-vscode",
        "ms-python.python",
        "ms-python.pylint",
        "ms-python.black-formatter",
        // Playwright
        "ms-playwright.playwright",
        // コラボ
        "ms-vsliveshare.vsliveshare"
      ],
      "settings": {
        "terminal.integrated.defaultProfile.linux": "zsh",
        "editor.formatOnSave": true,
        "python.formatting.provider": "black",
        "python.linting.pylintEnabled": true,
        "python.analysis.typeCheckingMode": "basic",
        "git.autofetch": true
      }
    }
  },

  // コンテナ内ユーザー
  "remoteUser": "vscode",

  // Git の設定（あれば使う／無ければスルー）※readonly 推奨
  "mounts": [
    "source=${localEnv:HOME}/.gitconfig,target=/home/vscode/.gitconfig,type=bind,consistency=cached,readonly",
    "source=${localEnv:HOME}/.git-credentials,target=/home/vscode/.git-credentials,type=bind,consistency=cached,readonly"
  ],

  // 初回：safe.directory 登録 → MCP 自動登録
  "postCreateCommand": "sudo git config --system --add safe.directory ${containerWorkspaceFolder} && bash /usr/local/bin/post-create-setup.sh",

  // 起動毎：ワークスペースの所有者を vscode に（保存権限対策）
  "postStartCommand": "sudo chown -R vscode:vscode ${containerWorkspaceFolder} || true"
}
