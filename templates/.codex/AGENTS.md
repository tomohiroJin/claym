# Codex CLI エージェント指示

このファイルは Codex CLI エージェントに対する永続的な指示を提供します。

## 言語設定

**日本語を基本言語として使用してください。**

- すべての応答は日本語で行う
- コメントは日本語で記述
- ドキュメントは日本語で作成
- エラーメッセージの説明は日本語で
- コードそのもの（変数名、関数名など）は英語でも可

## コミュニケーションスタイル

- 丁寧語を使用（「です・ます」調）
- 技術用語は適切に日本語訳するか、英語のままカタカナ表記
- 不明点は必ず質問する
- 段階的に説明し、理解を確認しながら進める

## 作業原則

### 変更前の確認
- コードを変更する前に、必ず既存の実装を読んで理解する
- 影響範囲を事前に提示し、承認を得てから作業する
- 既存のコードパターン・規約を尊重し、一貫性を保つ

### 安全な作業
- 破壊的変更を行う前に必ず確認する
- 一度に大きな変更をせず、小さなステップで進める
- 変更後は関連するテストを実行して動作確認する

### 情報の正確性
- 不確かな情報は推測であることを明示する
- ライブラリのバージョンやAPIの仕様は最新ドキュメントで確認する
- エラーの原因が不明な場合は、複数の可能性を提示する

## 作業パターン

### TDD サイクル
1. 失敗するテストを書く（Red）
2. テストを通す最小限の実装（Green）
3. リファクタリング（Refactor）

### テスト実行コマンド

```bash
# JavaScript / TypeScript
npm test
npm test -- --watch
npm test -- --coverage

# Python
poetry run pytest tests/
poetry run pytest --cov=src tests/
poetry run pytest tests/test_example.py -v
```

## コード品質基準

### 共通原則
- マジックナンバーは定数化する
- 関数は単一責任の原則に従う（1関数1目的）
- 早期リターンで条件分岐のネストを浅く保つ
- 命名で意図を表現する（コメントに頼らない）
- 関数は30行以内を目安（超える場合は分割を検討）
- パラメータは3個以内（超える場合はオブジェクトにまとめる）

### TypeScript / JavaScript（該当プロジェクトの場合）
- `any` 型の使用禁止 → `unknown` + 型ガードを使用
- `null` より `undefined` を優先（API 境界を除く）
- `const` を優先、`let` は必要な場合のみ、`var` は禁止

## コーディング規約

### 命名規則
- 変数名・関数名: `camelCase` (JS/TS) / `snake_case` (Python)
- クラス名: `PascalCase`
- 定数: `UPPER_SNAKE_CASE`
- ブール値: `is_`, `has_`, `can_` などの接頭辞

### コメント
- 複雑なロジックには必ずコメントを追加（日本語）
- TODO: `# TODO(日付): 説明`

## Git ワークフロー

### コミットメッセージ
Conventional Commits 準拠:
```
<type>: <日本語での説明>

- 詳細1
- 詳細2
```

**type**: `feat` / `fix` / `docs` / `refactor` / `test` / `style` / `chore` / `perf`

### ブランチ命名
- `feature/<機能名>` / `fix/<バグ名>` / `refactor/<対象>`

## テスト

### テスト規約
- AAA パターン（Arrange / Act / Assert）で記述
- 振る舞いベース（内部実装ではなく外部振る舞いをテスト）
- テストは独立・冪等に保つ
- カバレッジ目標: 新規コードは80%以上

## セキュリティ

- API キーや認証情報は環境変数で管理
- `.env` ファイルは `.gitignore` に含める
- 外部入力は必ずバリデーション
- ユーザー入力をクエリ文字列に直接連結しない

## 参考資料

<!-- プロジェクトに応じて適宜変更してください -->
- プロジェクトドキュメント: `docs/`
