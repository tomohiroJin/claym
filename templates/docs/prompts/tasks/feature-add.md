# 機能追加プロンプト

新しい機能を追加する際のチェックリストとガイドラインです。

## 目的

新機能を安全かつ効率的に追加し、プロジェクトの品質を維持する。

## 事前準備

### 要件の明確化

以下の質問に答えてください：

1. **何を実現したいか？**
   - 機能の目的と価値
   - ユーザーにとっての利点

2. **誰が使うか？**
   - 対象ユーザー
   - 使用頻度

3. **どのように使うか？**
   - 使用方法・フロー
   - 入力と出力

4. **制約条件は？**
   - パフォーマンス要件
   - セキュリティ要件
   - 互換性要件

## 実装手順

### 1. 仕様の確認

- [ ] 機能要件を明確化
- [ ] 非機能要件（パフォーマンス、セキュリティ等）を確認
- [ ] 既存機能への影響を評価
- [ ] 依存関係を確認

### 2. 設計の検討

- [ ] アーキテクチャへの適合を確認
- [ ] インターフェース設計
- [ ] データ構造の設計
- [ ] エラーハンドリングの設計

**設計ドキュメント作成**:
```markdown
## 機能名: [機能名]

### 概要
[機能の概要]

### アーキテクチャ
[図やテキストで説明]

### API/インターフェース
[公開するAPI]

### データ構造
[使用するデータ構造]

### エラーハンドリング
[エラーの種類と対応]
```

### 3. ブランチ作成

```bash
git checkout -b feature/[機能名]
```

### 4. テストの作成（TDD推奨）

- [ ] ユニットテストを作成
- [ ] 統合テストを作成
- [ ] テストが失敗することを確認（レッドフェーズ）

**テストテンプレート**:
```python
def test_新機能_正常系():
    """新機能が正常に動作することを確認"""
    # Arrange: 準備
    input_data = ...

    # Act: 実行
    result = new_feature(input_data)

    # Assert: 検証
    assert result == expected_result

def test_新機能_異常系():
    """エラーケースを確認"""
    with pytest.raises(ExpectedException):
        new_feature(invalid_input)
```

### 5. 実装

- [ ] コーディング規約に従って実装
- [ ] 適切なコメント・docstringを追加
- [ ] エラーハンドリングを実装
- [ ] ログ出力を追加

**実装のポイント**:
- 関数は小さく保つ（単一責任の原則）
- 再利用可能なコードにする
- マジックナンバーを避ける（定数化）
- 早期リターンでネストを減らす

### 6. テストの実行

- [ ] ユニットテストが通ることを確認（グリーンフェーズ）
- [ ] 統合テストが通ることを確認
- [ ] カバレッジを確認（目標: 80%以上）
- [ ] 既存のテストが壊れていないことを確認

```bash
# テスト実行
pytest tests/

# カバレッジ確認
pytest --cov=src tests/
```

### 7. リファクタリング

- [ ] コードの重複を削除
- [ ] 命名を改善
- [ ] 構造を最適化
- [ ] パフォーマンスを改善（必要に応じて）

### 8. ドキュメントの更新

- [ ] API ドキュメントを更新
- [ ] README.md を更新（必要に応じて）
- [ ] CHANGELOG.md に変更を記録
- [ ] 使用例を追加

**ドキュメントテンプレート**:
````markdown
## 新機能: [機能名]

### 概要
[機能の説明]

### 使用方法

```[language]
# 基本的な使い方
result = new_feature(input_data)

# オプションを指定
result = new_feature(input_data, option=value)
```

### パラメータ

| 名前 | 型 | 説明 | デフォルト |
|------|-----|------|-----------|
| input_data | str | 入力データ | 必須 |
| option | int | オプション設定 | 0 |

### 戻り値

| 型 | 説明 |
|----|------|
| Result | 処理結果 |

### 例外

| 例外 | 発生条件 |
|------|----------|
| ValueError | 不正な入力 |

### 例

```[language]
# 実用的な例
data = prepare_data()
result = new_feature(data)
process_result(result)
```
````

### 9. コードレビュー準備

- [ ] コミットメッセージを整理
- [ ] PR の説明を準備
- [ ] スクリーンショット・デモを用意（UI変更の場合）

**PR テンプレート**:
```markdown
## 概要
[変更の概要]

## 変更内容
- [変更点1]
- [変更点2]

## 動機・背景
[なぜこの変更が必要か]

## テスト
- [ ] ユニットテスト追加
- [ ] 統合テスト追加
- [ ] 手動テスト完了

## チェックリスト
- [ ] コーディング規約に準拠
- [ ] テストが通る
- [ ] ドキュメント更新済み
- [ ] 破壊的変更なし（または移行パス提供）

## 関連Issue
Closes #[issue番号]
```

## 確認事項

### セキュリティ

- [ ] 入力値のバリデーション
- [ ] SQLインジェクション対策（該当する場合）
- [ ] XSS対策（該当する場合）
- [ ] 認証・認可の確認
- [ ] 機密情報の適切な管理

### パフォーマンス

- [ ] 計算量の確認（O記法）
- [ ] メモリ使用量の確認
- [ ] データベースクエリの最適化（該当する場合）
- [ ] キャッシュの活用（必要に応じて）

### 互換性

- [ ] 既存のAPIとの互換性
- [ ] データ形式の互換性
- [ ] バージョン間の移行パス

### アクセシビリティ（UI変更の場合）

- [ ] キーボード操作対応
- [ ] スクリーンリーダー対応
- [ ] 色のコントラスト確認
- [ ] レスポンシブデザイン

## トラブルシューティング

### よくある問題

**Q: テストが通らない**
- エラーメッセージを詳しく読む
- デバッガで変数の値を確認
- テストの前提条件を確認

**Q: パフォーマンスが悪い**
- プロファイラで ボトルネックを特定
- アルゴリズムを見直す
- キャッシュやメモ化を検討

**Q: 既存機能が壊れた**
- どのテストが失敗したか確認
- git diff で変更箇所を確認
- 段階的にコミットを戻して原因を特定

## ベストプラクティス

1. **小さく始める**: 最小限の動作する実装から始める（MVP）
2. **早期フィードバック**: 早い段階でレビューを依頼
3. **段階的な実装**: 大きな機能は複数のPRに分割
4. **テストファースト**: テストを先に書くと設計が改善される
5. **ドキュメント重視**: 未来の自分や他の開発者のために

## 完了条件

以下が全て満たされたら、機能追加は完了です：

- [ ] 仕様を満たす実装が完了
- [ ] テストが全て通る
- [ ] カバレッジが目標値以上
- [ ] ドキュメントが更新されている
- [ ] コードレビューで承認された
- [ ] CI/CDが通っている

## 参考

- プロジェクトのコーディング規約
- アーキテクチャドキュメント
- 類似機能の実装例
